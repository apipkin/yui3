YUI.add("uploader-flash",function(h,g){var b=h.substitute,f=h.Uploader.Queue,c=h.ClassNameManager.getClassName,d="uploader",e=c(d,"selectfiles-button");function a(i){a.superclass.constructor.apply(this,arguments);}h.UploaderFlash=h.extend(a,h.Widget,{_buttonState:"up",_buttonFocus:false,_swfContainerId:null,_swfReference:null,queue:null,_tabElementBindings:null,initializer:function(){this._swfContainerId=h.guid("uploader");this._swfReference=null;this.queue=null;this._buttonState="up";this._buttonFocus=null;this._tabElementBindings=null;this._fileList=[];this.publish("fileselect");this.publish("uploadstart");this.publish("fileuploadstart");this.publish("uploadprogress");this.publish("totaluploadprogress");this.publish("uploadcomplete");this.publish("alluploadscomplete");this.publish("uploaderror");this.publish("mouseenter");this.publish("mouseleave");this.publish("mousedown");this.publish("mouseup");this.publish("click");},renderUI:function(){var j=this.get("boundingBox"),i=this.get("contentBox"),l=this.get("selectFilesButton");j.setStyle("position","relative");l.setStyles({width:"100%",height:"100%"});i.append(l);i.append(h.Node.create(b(a.FLASH_CONTAINER,{swfContainerId:this._swfContainerId})));var k=h.one("#"+this._swfContainerId);var m={version:"10.0.45",fixedAttributes:{wmode:"transparent",allowScriptAccess:"always",allowNetworking:"all",scale:"noscale"}};this._swfReference=new h.SWF(k,this.get("swfURL"),m);},bindUI:function(){this._swfReference.on("swfReady",function(){this._setMultipleFiles();this._setFileFilters();this._triggerEnabled();this._attachTabElements();this.after("multipleFilesChange",this._setMultipleFiles,this);this.after("fileFiltersChange",this._setFileFilters,this);this.after("enabledChange",this._triggerEnabled,this);this.after("tabElementsChange",this._attachTabElements);},this);this._swfReference.on("fileselect",this._updateFileList,this);this._swfReference.on("mouseenter",function(){this.fire("mouseenter");this._setButtonClass("hover",true);if(this._buttonState=="down"){this._setButtonClass("active",true);}},this);this._swfReference.on("mouseleave",function(){this.fire("mouseleave");this._setButtonClass("hover",false);this._setButtonClass("active",false);},this);this._swfReference.on("mousedown",function(){this.fire("mousedown");this._buttonState="down";this._setButtonClass("active",true);},this);this._swfReference.on("mouseup",function(){this.fire("mouseup");this._buttonState="up";this._setButtonClass("active",false);},this);this._swfReference.on("click",function(){this.fire("click");this._buttonFocus=true;this._setButtonClass("focus",true);h.one("body").focus();this._swfReference._swf.focus();},this);},_attachTabElements:function(j){if(this.get("tabElements")!==null&&this.get("tabElements").from!==null&&this.get("tabElements").to!==null){if(this._tabElementBindings!==null){this._tabElementBindings.from.detach();this._tabElementBindings.to.detach();this._tabElementBindings.tabback.detach();this._tabElementBindings.tabforward.detach();this._tabElementBindings.focus.detach();this._tabElementBindings.blur.detach();}else{this._tabElementBindings={};}var k=h.one(this.get("tabElements").from);var i=h.one(this.get("tabElements").to);this._tabElementBindings.from=k.on("keydown",function(l){if(l.keyCode==9&&!l.shiftKey){l.preventDefault();this._swfReference._swf.setAttribute("tabindex",0);this._swfReference._swf.setAttribute("role","button");this._swfReference._swf.setAttribute("aria-label",this.get("selectButtonLabel"));this._swfReference._swf.focus();}},this);this._tabElementBindings.to=i.on("keydown",function(l){if(l.keyCode==9&&l.shiftKey){l.preventDefault();this._swfReference._swf.setAttribute("tabindex",0);this._swfReference._swf.setAttribute("role","button");this._swfReference._swf.setAttribute("aria-label",this.get("selectButtonLabel"));this._swfReference._swf.focus();}},this);this._tabElementBindings.tabback=this._swfReference.on("tabback",function(l){this._swfReference._swf.blur();setTimeout(function(){k.focus();},30);},this);this._tabElementBindings.tabforward=this._swfReference.on("tabforward",function(l){this._swfReference._swf.blur();setTimeout(function(){i.focus();},30);},this);this._tabElementBindings.focus=this._swfReference._swf.on("focus",function(l){this._buttonFocus=true;this._setButtonClass("focus",true);},this);this._tabElementBindings.blur=this._swfReference._swf.on("blur",function(l){this._buttonFocus=false;this._setButtonClass("focus",false);},this);}else{if(this._tabElementBindings!==null){this._tabElementBindings.from.detach();this._tabElementBindings.to.detach();this._tabElementBindings.tabback.detach();this._tabElementBindings.tabforward.detach();this._tabElementBindings.focus.detach();this._tabElementBindings.blur.detach();}}},_setButtonClass:function(i,j){if(j){this.get("selectFilesButton").addClass(this.get("buttonClassNames")[i]);}else{this.get("selectFilesButton").removeClass(this.get("buttonClassNames")[i]);}},_setFileFilters:function(){if(this._swfReference&&this.get("fileFilters").length>0){this._swfReference.callSWF("setFileFilters",[this.get("fileFilters")]);}},_setMultipleFiles:function(){if(this._swfReference){this._swfReference.callSWF("setAllowMultipleFiles",[this.get("multipleFiles")]);}},_triggerEnabled:function(){if(this.get("enabled")){this._swfReference.callSWF("enable");this._swfReference._swf.setAttribute("aria-disabled","false");this._setButtonClass("disabled",false);}else{this._swfReference.callSWF("disable");this._swfReference._swf.setAttribute("aria-disabled","true");this._setButtonClass("disabled",true);}},_getFileList:function(i){return this._fileList.concat();},_setFileList:function(i){this._fileList=i.concat();return this._fileList.concat();},_updateFileList:function(l){h.one("body").focus();this._swfReference._swf.focus();var k=l.fileList,o=[],j=[],i=this._swfReference,n=this.get("fileFilterFunction");h.each(k,function(q){var p={};p.id=q.fileId;p.name=q.fileReference.name;p.size=q.fileReference.size;p.type=q.fileReference.type;
p.dateCreated=q.fileReference.creationDate;p.dateModified=q.fileReference.modificationDate;p.uploader=i;o.push(p);});if(n){h.each(o,function(q){var p=new h.FileFlash(q);if(n(p)){j.push(p);}});}else{h.each(o,function(p){j.push(new h.FileFlash(p));});}if(j.length>0){var m=this.get("fileList");this.set("fileList",this.get("appendNewFiles")?m.concat(j):j);this.fire("fileselect",{fileList:j});}},_uploadEventHandler:function(i){switch(i.type){case"file:uploadstart":this.fire("fileuploadstart",i);break;case"file:uploadprogress":this.fire("uploadprogress",i);break;case"uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",i);break;case"file:uploadcomplete":this.fire("uploadcomplete",i);break;case"uploaderqueue:alluploadscomplete":this.queue=null;this.fire("alluploadscomplete",i);break;case"file:uploaderror":case"uploaderqueue:uploaderror":this.fire("uploaderror",i);break;case"file:uploadcancel":case"uploaderqueue:uploadcancel":this.fire("uploadcancel",i);break;}},upload:function(m,k,n){var l=k||this.get("uploadURL"),j=n||this.get("postVarsPerFile"),i=m.get("id");j=j.hasOwnProperty(i)?j[i]:j;if(m instanceof h.FileFlash){m.on("uploadstart",this._uploadEventHandler,this);m.on("uploadprogress",this._uploadEventHandler,this);m.on("uploadcomplete",this._uploadEventHandler,this);m.on("uploaderror",this._uploadEventHandler,this);m.on("uploadcancel",this._uploadEventHandler,this);m.startUpload(l,j,this.get("fileFieldName"));}},uploadAll:function(i,j){this.uploadThese(this.get("fileList"),i,j);},uploadThese:function(m,j,l){if(!this.queue){var k=j||this.get("uploadURL"),i=l||this.get("postVarsPerFile");this.queue=new f({simUploads:this.get("simLimit"),errorAction:this.get("errorAction"),fileFieldName:this.get("fileFieldName"),fileList:m,uploadURL:k,perFileParameters:i,retryCount:this.get("retryCount")});this.queue.on("uploadstart",this._uploadEventHandler,this);this.queue.on("uploadprogress",this._uploadEventHandler,this);this.queue.on("totaluploadprogress",this._uploadEventHandler,this);this.queue.on("uploadcomplete",this._uploadEventHandler,this);this.queue.on("alluploadscomplete",this._uploadEventHandler,this);this.queue.on("alluploadscancelled",function(n){this.queue=null;},this);this.queue.on("uploaderror",this._uploadEventHandler,this);this.queue.startUpload();this.fire("uploadstart");}}},{FLASH_CONTAINER:"<div id='{swfContainerId}' style='position:absolute; top:0px; left: 0px; margin: 0; padding: 0; border: 0; width:100%; height:100%'></div>",SELECT_FILES_BUTTON:"<button type='button' class='yui3-button' tabindex='-1'>{selectButtonLabel}</button>",TYPE:"flash",NAME:"uploader",ATTRS:{appendNewFiles:{value:true},buttonClassNames:{value:{"hover":"yui3-button-hover","active":"yui3-button-active","disabled":"yui3-button-disabled","focus":"yui3-button-selected"}},enabled:{value:true},errorAction:{value:"continue",validator:function(j,i){return(j===f.CONTINUE||j===f.STOP||j===f.RESTART_ASAP||j===f.RESTART_AFTER);}},fileFilters:{value:[]},fileFilterFunction:{value:null},fileFieldName:{value:"Filedata"},fileList:{value:[],getter:"_getFileList",setter:"_setFileList"},multipleFiles:{value:false},postVarsPerFile:{value:{}},selectButtonLabel:{value:"Select Files"},selectFilesButton:{valueFn:function(){return h.Node.create(b(h.UploaderFlash.SELECT_FILES_BUTTON,{selectButtonLabel:this.get("selectButtonLabel")}));}},simLimit:{value:2,validator:function(j,i){return(j>=2&&j<=5);}},swfURL:{valueFn:function(){var i=h.Env.cdn+"uploader/assets/flashuploader.swf";if(h.UA.ie>0){return(i+"?t="+h.guid("uploader"));}return i;}},tabElements:{value:null},uploadURL:{value:""},retryCount:{value:3}}});h.UploaderFlash.Queue=f;},"@VERSION@",{"requires":["swf","widget","substitute","base","cssbutton","node","event-custom","file-flash","uploader-queue"]});