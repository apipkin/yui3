YUI.add("uploader-html5",function(e,d){var a=e.substitute,c=e.Uploader.Queue;function b(f){b.superclass.constructor.apply(this,arguments);}e.UploaderHTML5=e.extend(b,e.Widget,{_fileInputField:null,_buttonBinding:null,queue:null,initializer:function(){this._fileInputField=null;this.queue=null;this._buttonBinding=null;this._fileList=[];this.publish("fileselect");this.publish("uploadstart");this.publish("fileuploadstart");this.publish("uploadprogress");this.publish("totaluploadprogress");this.publish("uploadcomplete");this.publish("alluploadscomplete");this.publish("uploaderror");this.publish("dragenter");this.publish("dragover");this.publish("dragleave");this.publish("drop");},renderUI:function(){var h=this.get("boundingBox"),f=this.get("contentBox"),g=this.get("selectFilesButton");g.setStyles({width:"100%",height:"100%"});f.append(g);this._fileInputField=e.Node.create(b.HTML5FILEFIELD_TEMPLATE);f.append(this._fileInputField);},bindUI:function(){this._bindSelectButton();this._setMultipleFiles();this._setFileFilters();this._bindDropArea();this._triggerEnabled();this.after("multipleFilesChange",this._setMultipleFiles,this);this.after("fileFiltersChange",this._setFileFilters,this);this.after("enabledChange",this._triggerEnabled,this);this.after("selectFilesButtonChange",this._bindSelectButton,this);this.after("dragAndDropAreaChange",this._bindDropArea,this);this.after("tabIndexChange",function(f){this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"));},this);this._fileInputField.on("change",this._updateFileList,this);this.get("selectFilesButton").set("tabIndex",this.get("tabIndex"));},_rebindFileField:function(){this._fileInputField.remove(true);this._fileInputField=e.Node.create(b.HTML5FILEFIELD_TEMPLATE);this.get("contentBox").append(this._fileInputField);this._fileInputField.on("change",this._updateFileList,this);this._setMultipleFiles();this._setFileFilters();},_bindDropArea:function(g){var f=g||{prevVal:null};if(f.prevVal!==null){f.prevVal.detach("drop",this._ddEventHandler);f.prevVal.detach("dragenter",this._ddEventHandler);f.prevVal.detach("dragover",this._ddEventHandler);f.prevVal.detach("dragleave",this._ddEventHandler);}var h=this.get("dragAndDropArea");if(h!==null){h.on("drop",this._ddEventHandler,this);h.on("dragenter",this._ddEventHandler,this);h.on("dragover",this._ddEventHandler,this);h.on("dragleave",this._ddEventHandler,this);}},_bindSelectButton:function(){this._buttonBinding=this.get("selectFilesButton").on("click",this.openFileSelectDialog,this);},_ddEventHandler:function(h){h.stopPropagation();h.preventDefault();switch(h.type){case"dragenter":this.fire("dragenter");break;case"dragover":this.fire("dragover");break;case"dragleave":this.fire("dragleave");break;case"drop":var g=h._event.dataTransfer.files,f=[],j=this.get("fileFilterFunction");if(j){e.each(g,function(l){var k=new e.FileHTML5(l);if(j(k)){f.push(k);}});}else{e.each(g,function(k){f.push(new e.FileHTML5(k));});}if(f.length>0){var i=this.get("fileList");this.set("fileList",this.get("appendNewFiles")?i.concat(f):f);this.fire("fileselect",{fileList:f});}this.fire("drop");break;}},_setButtonClass:function(f,g){if(g){this.get("selectFilesButton").addClass(this.get("buttonClassNames")[f]);}else{this.get("selectFilesButton").removeClass(this.get("buttonClassNames")[f]);}},_setMultipleFiles:function(){if(this.get("multipleFiles")===true){this._fileInputField.set("multiple","multiple");}else{this._fileInputField.set("multiple","");}},_setFileFilters:function(){if(this.get("fileFilters").length>0){this._fileInputField.set("accept",this.get("fileFilters").join(","));}else{this._fileInputField.set("accept","");}},_triggerEnabled:function(){if(this.get("enabled")&&this._buttonBinding===null){this._bindSelectButton();this._setButtonClass("disabled",false);this.get("selectFilesButton").setAttribute("aria-disabled","false");}else{if(!this.get("enabled")&&this._buttonBinding){this._buttonBinding.detach();this._buttonBinding=null;this._setButtonClass("disabled",true);this.get("selectFilesButton").setAttribute("aria-disabled","true");}}},_getFileList:function(f){return this._fileList.concat();},_setFileList:function(f){this._fileList=f.concat();return this._fileList.concat();},_updateFileList:function(h){var g=h.target.getDOMNode().files,f=[],j=this.get("fileFilterFunction");if(j){e.each(g,function(l){var k=new e.FileHTML5(l);if(j(k)){f.push(k);}});}else{e.each(g,function(k){f.push(new e.FileHTML5(k));});}if(f.length>0){var i=this.get("fileList");this.set("fileList",this.get("appendNewFiles")?i.concat(f):f);this.fire("fileselect",{fileList:f});}this._rebindFileField();},_uploadEventHandler:function(f){switch(f.type){case"file:uploadstart":this.fire("fileuploadstart",f);break;case"file:uploadprogress":this.fire("uploadprogress",f);break;case"uploaderqueue:totaluploadprogress":this.fire("totaluploadprogress",f);break;case"file:uploadcomplete":this.fire("uploadcomplete",f);break;case"uploaderqueue:alluploadscomplete":this.queue=null;this.fire("alluploadscomplete",f);break;case"file:uploaderror":case"uploaderqueue:uploaderror":this.fire("uploaderror",f);break;case"file:uploadcancel":case"uploaderqueue:uploadcancel":this.fire("uploadcancel",f);break;}},openFileSelectDialog:function(){var f=this._fileInputField.getDOMNode();if(f.click){f.click();}},upload:function(j,h,k){var i=h||this.get("uploadURL"),g=k||this.get("postVarsPerFile"),f=j.get("id");g=g.hasOwnProperty(f)?g[f]:g;if(j instanceof e.FileHTML5){j.on("uploadstart",this._uploadEventHandler,this);j.on("uploadprogress",this._uploadEventHandler,this);j.on("uploadcomplete",this._uploadEventHandler,this);j.on("uploaderror",this._uploadEventHandler,this);j.on("uploadcancel",this._uploadEventHandler,this);j.startUpload(i,g,this.get("fileFieldName"));}},uploadAll:function(f,g){this.uploadThese(this.get("fileList"),f,g);},uploadThese:function(j,g,i){if(!this.queue){var h=g||this.get("uploadURL"),f=i||this.get("postVarsPerFile");this.queue=new c({simUploads:this.get("simLimit"),errorAction:this.get("errorAction"),fileFieldName:this.get("fileFieldName"),fileList:j,uploadURL:h,perFileParameters:f,retryCount:this.get("retryCount"),uploadHeaders:this.get("uploadHeaders"),withCredentials:this.get("withCredentials")});
this.queue.on("uploadstart",this._uploadEventHandler,this);this.queue.on("uploadprogress",this._uploadEventHandler,this);this.queue.on("totaluploadprogress",this._uploadEventHandler,this);this.queue.on("uploadcomplete",this._uploadEventHandler,this);this.queue.on("alluploadscomplete",this._uploadEventHandler,this);this.queue.on("uploadcancel",this._uploadEventHandler,this);this.queue.on("uploaderror",this._uploadEventHandler,this);this.queue.startUpload();this.fire("uploadstart");}else{if(this.queue._currentState===c.UPLOADING){this.queue.set("perFileParameters",this.get("postVarsPerFile"));e.each(j,function(k){this.queue.addToQueueBottom(k);},this);}}}},{HTML5FILEFIELD_TEMPLATE:"<input type='file' style='visibility:hidden; width:0px; height: 0px;'>",SELECT_FILES_BUTTON:"<button type='button' class='yui3-button' role='button' aria-label='{selectButtonLabel}' tabindex='{tabIndex}'>{selectButtonLabel}</button>",TYPE:"html5",NAME:"uploader",ATTRS:{appendNewFiles:{value:true},buttonClassNames:{value:{"hover":"yui3-button-hover","active":"yui3-button-active","disabled":"yui3-button-disabled","focus":"yui3-button-selected"}},dragAndDropArea:{value:null,setter:function(f){return e.one(f);}},enabled:{value:true},errorAction:{value:"continue",validator:function(g,f){return(g===c.CONTINUE||g===c.STOP||g===c.RESTART_ASAP||g===c.RESTART_AFTER);}},fileFilters:{value:[]},fileFilterFunction:{value:null},fileFieldName:{value:"Filedata"},fileList:{value:[],getter:"_getFileList",setter:"_setFileList"},multipleFiles:{value:false},postVarsPerFile:{value:{}},selectButtonLabel:{value:"Select Files"},selectFilesButton:{valueFn:function(){return e.Node.create(a(e.UploaderHTML5.SELECT_FILES_BUTTON,{selectButtonLabel:this.get("selectButtonLabel"),tabIndex:this.get("tabIndex")}));}},simLimit:{value:2,validator:function(g,f){return(g>=1&&g<=5);}},uploadURL:{value:""},uploadHeaders:{value:{}},withCredentials:{value:true},retryCount:{value:3}}});e.UploaderHTML5.Queue=c;},"@VERSION@",{"requires":["widget","node-event-simulate","substitute","file-html5","uploader-queue"]});